<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <script type="text/x-mathjax-config">
        /* Fix org-generated pictures to MathJX. Big thanks to Davide Cervone
          on StackOverflow with this. http://stackoverflow.com/a/14631703/308668
          */
        MathJax.Extension.myImg2jax = {
            version: "1.0",
            PreProcess: function (element) {
                var images = element.getElementsByTagName("img");
                for (var i = images.length - 1; i >= 0; i--) {
                    var img = images[i];
                    if (img.className === "dvipng") {
                        var script = document.createElement("script");
                        script.type = "math/tex";
                        var match = img.alt.match(/^(\$\$?)(.*)\1/);
                        if (match[1] === "$$") {script.type += ";mode=display"}
                        MathJax.HTML.setScript(script,match[2]);
                        img.parentNode.replaceChild(script,img);
                    }
                }
            }
        };
        MathJax.Hub.Register.PreProcessor(["PreProcess",MathJax.Extension.myImg2jax]);
    </script>
    <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript">
    </script>
    <link href="/templates/main.css" media="screen" type="text/css" rel="stylesheet" />
  
  <title>Pelisavetukset versiohallintaan — fwwm.us</title>
  <link />
</head>
  <body>
    <div id="backgrounds">
      <div id="header">
        <h1 id="site-title">fwwm.us</h1>
      </div>
      <div id="sidebar">
  <ul id="navigation" class="navi-list">
    <li><a href="/">Ylös</a></li>
    <li><a href="/all.html">Kaikki jutut</a></li>
    <!-- <li><a href=".">RSS</a></li> -->
  </ul>
  <ul class="info-list">
    <li>
      <div>
        <span class="value" id="post-created">27.06.2013</span>
        <span class="key">Luotu</span>
      </div>
    </li>
    <li>
      <div>
        <span class="value" id="post-modified">29.01.2014</span>
        <span class="key">Päivitetty</span>
      </div>
    </li>
    <li>
      <a href="https://github.com/progo/fwwmus---org/commits/main/miete/pelisavetukset-versiohallintaan.org" id="post-revs-url">
        <span>Muutoshistoria</span>
      </a>
    </li>
  </ul>

  <h2>Tagit</h2>
  <ul id="tags" class="tag-list"><li class="tag-2"><a href="/tags/koodi.html" class="tag-name">koodi</a></li><li class="tag-2"><a href="/tags/pelit.html" class="tag-name">pelit</a></li><li class="tag-1"><a href="/tags/fallout.html" class="tag-name">fallout</a></li><li class="tag-0"><a href="/tags/bash.html" class="tag-name">bash</a></li></ul>

  <h2 id="related-posts-title">Aiheen vierestä</h2>
  <ul id="related-posts">
    <li>
      <a href="/miete/naytonsaastajaskriptit.html" class="rp-url">
        <span class="rp-title">Näytönsäästäjäskriptit</span>
      </a>
    </li><li>
      <a href="/miete/illuminatukseni.html" class="rp-url">
        <span class="rp-title">Illuminatukseni</span>
      </a>
    </li><li>
      <a href="/miete/java-js-pelialustana.html" class="rp-url">
        <span class="rp-title">Java + JavaScript, paras pelialusta?</span>
      </a>
    </li><li>
      <a href="/viihde/pelit-vs-elokuvat.html" class="rp-url">
        <span class="rp-title">Pelit ja elokuvat</span>
      </a>
    </li><li>
      <a href="/viihde/fallout.html" class="rp-url">
        <span class="rp-title">Fallout</span>
      </a>
    </li>
  </ul>
</div>
      <div id="main">
  <div id="content">
<h1 class="title">Pelisavetukset versiohallintaan</h1>
<div class="outline-2" id="outline-container-sec-1">

<div id="text-1" class="outline-text-2">

<p>
Huolehditko joskus epävakaiden pelien savetuksista? Erityisesti kun
savetuksien kanssa voi käydä monenlaista. Joskus vain jää
tallentamatta, joskus pelissä esiintyvä bugi pakottaa pelaajan
palaamaan reittejään takaisin. Entä jos sekään ei onnistu, ja
tallennusta on vain yhtä sorttia? Entä jos peli suoralta kädeltä
korruptoi tallennukset hassuissa tilanteissa (Civ 5, Test Drive:
Unlimited)?
</p>

<p>
Pannaan tietokone asialle: meillä on versiohallintoja, <code>git</code>, ja
meillä on työkaluja automatisoida versiointi aina tallennuksen
yhteydessä: <code>inotify</code>.
</p>

<p>
Inotify on kuuluisasti kernelin erikoisuus, joten käyttääksemme
sitä tyydyttävästi komentoriviltä tarvitsemme parit työkalut.
<a href="https://github.com/rvoicilas/inotify-tools/wiki">Inotify-tools</a> on se, mitä tarvitsemme. Vaatimukset pikku
demonillemme ovat:
</p>

<ul class="org-ul">
<li>pyörii aina taustalla
</li>
<li>ei pollaa tiedostoja, vaan käyttää jotain mainittua
inotify-rajapintaa
</li>
<li>kun muutoksia pelihakemistossa tapahtuu, ajetaan vakiorivi
shellissä
</li>
</ul>

<p>
Inotify ja inotify-tools hoitavat homman kotiin!
</p>

<p>
Oleellinen koodinpala lienee tämä näin:
</p>

<div class="org-src-container">

<pre class="src src-sh"><span class="code-comment-delimiter">#</span><span class="code-comment">!/bin/</span><span class="code-keyword">bash</span>
<span class="code-variable-name">SAVEDIR</span>=<span class="code-string">"/home/progo/My Games/FalloutNV/Saves/"</span>

<span class="code-builtin">cd</span> <span class="code-string">"$SAVEDIR"</span>
<span class="code-keyword">while </span><span class="code-builtin">true</span>
<span class="code-keyword">do</span>
    inotifywait -q -e delete -e close_write --excludei <span class="code-string">"\.bak$"</span> .

    <span class="code-comment-delimiter"># </span><span class="code-comment">check any FS-removals and do the same in repo</span>
    git ls-files --deleted -z | xargs -0 git rm &gt;/dev/null 2&gt;&amp;1

    <span class="code-comment-delimiter"># </span><span class="code-comment">add fallout saves ONLY</span>
    git add *.fos

    <span class="code-variable-name">COM_MSG</span>=<span class="code-sh-quoted-exec">`date +"Gamesave %F-%H%M%S"`</span>
    git commit -m <span class="code-string">"$COM_MSG"</span>   &gt; /dev/null 2&gt;&amp;1
<span class="code-keyword">done</span>
</pre>
</div>

<p>
Gitin me konfiguroimme siten, että se tekee "vakiocommitin"
päivämääräleimalla. Committia ei joka tapauksessa synny, jos mikään
ei hakemistossa muutu.
</p>

<p>
Delta-pakkauksen ansiosta levyä ei pala tarpeettomasti, vaikka
kommitteja tuleekin rajusti. Vaikka git onkin nopea, savetusten
lukumäärä kannattanee pitää vähäisenä. Falloutin tekemät autosavet
ja omat pikatallennukseni ulkoselailuissa riittävät omiin
tarkoituksiini kohtuullisen hyvin. Steamin ja muun datan
perusteella levytilaa palaa noin 20-30 megaa per pelattu tunti.
Repositorion voi aina resetoida, jos tuntuu menevän liikaa.
</p>

<p>
Nyt voinen pelailla levollisemmin, kun tiedän, että savet saa aina
ulos hyvinkin suurella tarkkuudella aina kun syntyy vakava jumi.
</p>
</div>
</div>
</div>
  <hr />
  <div id="comments"><div id="disqus">
    <div id="disqus_thread"></div>

    <script type="text/javascript">
        var disqus_shortname = 'progim';
        var disqus_identifier = '20130627_1957';

        (function() {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] ||
            document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>
        <a href="http://disqus.com/?ref_noscript">Disqus</a> vaatii JavaScript-tuen
        toimiakseen.
    </noscript> 
    <a class="dsq-brlink" href="http://disqus.com">
        comments powered by <span class="logo-disqus">Disqus</span>
    </a>
</div></div>
</div>
      <div id="footer"></div>
    </div>
  </body>

</html>